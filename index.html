# problem: Solving for 2D Burger Equation
import numpy as np
import matplotlib.pyplot as plt
###variable declarations
nx = 41
ny = 41
nt = 100
L = 2
W = 2
dx = L / (nx - 1)
dy = W / (ny - 1)
sigma = .0009
nu = 0.01              # kinematic Viscosity
dt = sigma * dx * dy / nu

u = np.ones((ny,nx))   # ny goes for rows, nx goes for columns
v = np.ones((ny,nx)) 
u[int(0.5/dx):int(1/dx), int(0.5/dy):int(1/dy)]  = 2 
v[int(0.5/dx):int(1/dx), int(0.5/dy):int(1/dy)]  = 2  #Defining initial condition (u at t=0).
un = u.copy()
vn = v.copy()

x = np.linspace(0,L,nx)
y = np.linspace(0,W,ny)
X,Y = np.meshgrid(x,y)
# Figure
plt.ion()
fig,(ax1,ax2) = plt.subplots(1,2, subplot_kw = {"projection" : "3d"})
surf1 = ax1.plot_surface(X,Y,u,cmap="jet")
surf2 = ax2.plot_surface(X,Y,v,cmap="jet")
fig.colorbar(surf1,label="u - velocity")
fig.colorbar(surf2,label="v - velocity")
for t in range(nt):
    # Defining Boundary conditions
    u[:,nx-1] = 1
    u[ny-1,:] = 1
    u[:,0] = 1
    u[0,:] = 1
    
    v[:,nx-1] = 1
    v[ny-1,:] = 1
    v[:,0] = 1
    v[0,:] = 1
    
    for j in range(1,ny-1):
        
        for i in range(1,nx-1):
            
            u[j,i] = un[j,i] - (dt/dx) * un[j,i]*(un[j,i] - un[j,i-1]) - (dt/dy)*vn[j,i]*(un[j,i] - un[j-1,i]) + (nu*dt/(dx)**2)* (un[j,i+1] -2*un[j,i] +un[j,i-1]) + (nu*dt/(dy)**2)* (un[j+1,i] - 2*un[j,i] +un[j-1,i])
            v[j,i] = un[j,i] - (dt/dx) * un[j,i]*(vn[j,i] - vn[j,i-1]) - (dt/dy)*vn[j,i]*(vn[j,i] - vn[j-1,i]) + (nu*dt/(dx)**2)* (vn[j,i+1] -2*vn[j,i] +vn[j,i-1]) + (nu*dt/(dy)**2)* (vn[j+1,i] - 2*vn[j,i] +vn[j-1,i])
            
    un = u.copy()
    vn = v.copy()
    
    ax1.clear()
    ax2.clear()
    surf1 = ax1.plot_surface(X,Y,u,cmap="jet")
    surf2 = ax2.plot_surface(X,Y,v,cmap="jet")
    
    ax1.set_xlabel("$x$")
    ax2.set_xlabel("$x$")
    ax1.set_ylabel("$y$")
    ax2.set_ylabel("$y$")
    ax1.set_zlabel("$z$")
    ax2.set_zlabel("$z$")
    
    fig.suptitle(f"2D Burgers Equation (u & v velocity fields) | Time step = {t}", fontsize=20, )
        
    ax1.set_zlim(1,2.2)
    ax2.set_zlim(1,2.2)
    plt.pause(0.06)


plt.ioff()
plt.show()
